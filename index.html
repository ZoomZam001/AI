<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Chat (Gemini)</title>

<!-- Prism.js for syntax highlighting -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-cpp.min.js"></script>

<style>
  body {
    background: #0e0e0e;
    color: #eee;
    font-family: system-ui, sans-serif;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
  }
  #chat {
    width: 90%;
    max-width: 800px;
    height: 80vh;
    overflow-y: auto;
    background: #1a1a1a;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 0 10px #000;
    display: flex;
    flex-direction: column;
    scroll-behavior: smooth;
  }
  .msg {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin: 10px 0;
    padding: 12px 16px;
    border-radius: 8px;
    white-space: pre-wrap;
    line-height: 1.4;
    width: fit-content;
    max-width: 90%;
  }
  .user {
    background: #2d7;
    align-self: flex-end;
    color: #000;
  }
  .bot {
    background: #2b2b2b;
    align-self: flex-start;
    color: #eee;
  }
  .avatar {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .bot .avatar {
    background: #2d7;
    animation: pulse 1.5s infinite;
  }
  .user .avatar {
    background: #555;
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 0.8; }
    50% { transform: scale(1.2); opacity: 1; }
  }
  code, pre {
    font-family: "Fira Code", monospace;
    font-size: 14px;
    border-radius: 8px;
  }
  pre {
    background: #111 !important;
    padding: 10px;
    overflow-x: auto;
  }
  #inputArea {
    display: flex;
    width: 90%;
    max-width: 800px;
    margin-top: 10px;
  }
  input {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 6px 0 0 6px;
    background: #222;
    color: #eee;
  }
  button {
    padding: 12px 18px;
    border: none;
    background: #2d7;
    color: #000;
    border-radius: 0 6px 6px 0;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background: #3f8;
  }
  #keySection {
    width: 90%;
    max-width: 800px;
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }
  #keyInput {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    background: #222;
    color: #eee;
    border: none;
  }
  #saveKey, #clearKey {
    border-radius: 8px;
    border: none;
    padding: 10px 15px;
    font-weight: bold;
    cursor: pointer;
  }
  #saveKey { background: #2d7; color: #000; }
  #clearKey { background: #d44; color: #fff; }
  .typing {
    display: inline-flex;
    align-items: center;
    gap: 3px;
  }
  .dot {
    width: 6px;
    height: 6px;
    background: #2d7;
    border-radius: 50%;
    animation: blink 1.4s infinite;
  }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes blink {
    0%, 80%, 100% { opacity: 0.2; transform: scale(1); }
    40% { opacity: 1; transform: scale(1.3); }
  }
</style>
</head>
<body>
  <h2>üíª AI Chat (Gemini)</h2>
  <div id="keySection">
    <input id="keyInput" type="password" placeholder="Enter your Gemini API Key" />
    <button id="saveKey">Save</button>
    <button id="clearKey">Clear</button>
  </div>
  <div id="chat"></div>
  <div id="inputArea">
    <input id="userInput" type="text" placeholder="Type your message..." />
    <button id="sendBtn">Send</button>
  </div>

<script>
const chat = document.getElementById("chat");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const keyInput = document.getElementById("keyInput");
const saveKey = document.getElementById("saveKey");
const clearKey = document.getElementById("clearKey");

// Load saved key
const savedKey = localStorage.getItem("geminiKey");
if (savedKey) keyInput.value = savedKey;

saveKey.onclick = () => {
  const key = keyInput.value.trim();
  if (key) {
    localStorage.setItem("geminiKey", key);
    alert("‚úÖ API Key saved locally!");
  } else alert("‚ö†Ô∏è Enter a valid key first.");
};
clearKey.onclick = () => {
  localStorage.removeItem("geminiKey");
  keyInput.value = "";
  alert("üóëÔ∏è API Key cleared!");
};

// Add message with avatar + typing animation
function addMessage(content, sender, isTyping = false) {
  const wrapper = document.createElement("div");
  wrapper.className = `msg ${sender}`;
  const avatar = document.createElement("div");
  avatar.className = "avatar";

  const message = document.createElement("div");
  message.className = "text";

  if (isTyping) {
    message.innerHTML = `<div class="typing"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
  } else {
    const codeBlockRegex = /```(\w+)?\n([\s\S]*?)```/g;
    let formatted = content.replace(codeBlockRegex, (m, lang, code) => {
      lang = lang || "javascript";
      return `<pre><code class="language-${lang}">${Prism.highlight(code, Prism.languages[lang] || Prism.languages.javascript, lang)}</code></pre>`;
    });
    formatted = formatted.replace(/`([^`]+)`/g, '<code>$1</code>');
    message.innerHTML = formatted;
  }

  wrapper.appendChild(avatar);
  wrapper.appendChild(message);
  chat.appendChild(wrapper);
  chat.scrollTop = chat.scrollHeight;
  return wrapper;
}

async function queryGemini(prompt) {
  const apiKey = localStorage.getItem("geminiKey") || keyInput.value.trim();
  if (!apiKey) {
    alert("Please enter and save your Gemini API key first.");
    return "‚ö†Ô∏è No API key.";
  }

  const response = await fetch(
    "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + apiKey,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    }
  );
  const data = await response.json();
  return data.candidates?.[0]?.content?.parts?.[0]?.text || "‚ö†Ô∏è No response";
}

sendBtn.onclick = async () => {
  const text = userInput.value.trim();
  if (!text) return;
  addMessage(text, "user");
  userInput.value = "";

  const typing = addMessage("", "bot", true);
  const reply = await queryGemini(text);
  typing.remove();
  addMessage(reply, "bot");
};

userInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") sendBtn.click();
});
</script>
</body>
</html>

