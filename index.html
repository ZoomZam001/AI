<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Chat — Coding Assistant</title>
  <meta name="description" content="Minimal AI chat for coding. Paste your OpenAI API key and chat." />
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --muted:#9aa4b2; --accent:#60a5fa;
      --user:#0ea5a4; --ai:#7c3aed;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071026);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;}
    .wrap{max-width:900px;margin:28px auto;padding:18px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; box-shadow:0 10px 30px rgba(2,6,23,0.6);}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
    h1{color:#e6eef8;font-size:18px;margin:0;}
    .muted{color:var(--muted);font-size:13px;}
    .controls{display:flex;gap:8px;align-items:center;margin:10px 0;}
    input[type="password"]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#dbeafe;}
    button{padding:9px 12px;border-radius:8px;border:0;background:var(--accent);color:#05223b;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    main{display:flex;gap:16px;}
    .chat{flex:1;min-height:420px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);overflow:auto;max-height:62vh;}
    .row{display:flex;gap:8px;margin:8px 0;align-items:flex-end}
    .msg{padding:12px;border-radius:10px;max-width:85%;white-space:pre-wrap;line-height:1.45}
    .from-user{margin-left:auto;background:linear-gradient(90deg,var(--user),#06b6d4);color:#022;box-shadow:0 6px 18px rgba(14,165,164,0.08)}
    .from-ai{background:linear-gradient(90deg,var(--ai),#8b5cf6);color:#061025;box-shadow:0 6px 18px rgba(124,58,237,0.06)}
    .meta{font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:6px}
    footer{display:flex;gap:8px;margin-top:12px;align-items:center}
    textarea{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#e6eef8;min-height:56px;resize:vertical}
    .note{font-size:12px;color:var(--muted);margin-top:8px}
    .small{font-size:12px;color:var(--muted)}
    .sys{width:100%;padding:8px;border-radius:8px;border:1px dashed rgba(255,255,255,0.03);background:transparent;color:var(--muted)}
    .center{display:flex;justify-content:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="flex:1">
        <h1>AI Chat — Coding Assistant</h1>
        <div class="muted">Simple chat UI — paste your OpenAI API key and ask for code help</div>
      </div>
      <div class="small">Single file • client-side</div>
    </header>

    <div class="controls">
      <input id="key" type="password" placeholder="Paste OpenAI API key (sk-...)" autocomplete="off" />
      <button id="save">Save</button>
      <button id="clear" class="ghost">Clear Key</button>
    </div>

    <div class="note">System prompt (controls assistant behavior):</div>
    <div style="margin:8px 0"><textarea id="system" class="sys" rows="2">You are a helpful assistant specialized in writing and explaining code. Give concise answers and include runnable examples when useful. Prefer safe, modern practices.</textarea></div>

    <main>
      <div class="chat" id="chat" aria-live="polite"></div>
    </main>

    <footer>
      <textarea id="input" placeholder="Ask about JavaScript, Python, HTML... (Shift+Enter for newline)"></textarea>
      <button id="send">Send</button>
    </footer>

    <div class="center" style="margin-top:10px">
      <div class="small muted">No messages are sent to any server except OpenAI. Keys are stored in localStorage only if you press Save.</div>
    </div>
  </div>

<script>
  // Minimal chat-only single-file app
  const keyInput = document.getElementById('key');
  const saveBtn = document.getElementById('save');
  const clearBtn = document.getElementById('clear');
  const sendBtn = document.getElementById('send');
  const inputEl = document.getElementById('input');
  const chat = document.getElementById('chat');
  const systemEl = document.getElementById('system');

  // load saved key
  if (localStorage.getItem('ai_chat_key')) keyInput.value = localStorage.getItem('ai_chat_key');

  saveBtn.onclick = () => {
    const k = keyInput.value.trim();
    if(!k){ alert('Paste an API key to save.'); return; }
    localStorage.setItem('ai_chat_key', k);
    alert('Key saved to localStorage (client-side).');
  };
  clearBtn.onclick = () => {
    localStorage.removeItem('ai_chat_key');
    keyInput.value = '';
    alert('Key cleared from localStorage.');
  };

  // In-memory history (role/content)
  const history = [];

  function addMessage(role, text){
    const wrap = document.createElement('div');
    wrap.className = 'row';
    const bubble = document.createElement('div');
    bubble.className = 'msg ' + (role === 'user' ? 'from-user' : 'from-ai');
    const meta = document.createElement('div');
    meta.className = 'meta';
    meta.textContent = role === 'user' ? 'You' : 'AI';
    bubble.appendChild(meta);
    const body = document.createElement('div');
    body.textContent = text;
    bubble.appendChild(body);
    wrap.appendChild(bubble);
    chat.appendChild(wrap);
    chat.scrollTop = chat.scrollHeight;
  }

  async function fetchReply(userText){
    const key = keyInput.value.trim() || localStorage.getItem('ai_chat_key');
    if(!key){ alert('Please paste your OpenAI API key in the box.'); return; }

    addMessage('user', userText);
    history.push({role:'user', content:userText});

    // placeholder
    const placeholder = document.createElement('div');
    placeholder.className = 'row';
    placeholder.innerHTML = '<div class="msg from-ai"><div class="meta">AI</div><div>...</div></div>';
    chat.appendChild(placeholder);
    chat.scrollTop = chat.scrollHeight;

    // build messages: system + last 12
    const messages = [{role:'system', content: systemEl.value}];
    const recent = history.slice(-12);
    recent.forEach(m => messages.push(m));

    try {
      const res = await fetch('https://api.openai.com/v1/chat/completions', {
        method:'POST',
        headers:{ 'Content-Type':'application/json', 'Authorization':'Bearer ' + key },
        body: JSON.stringify({
          model: 'gpt-4o-mini',
          messages,
          temperature: 0.15,
          max_tokens: 800
        })
      });

      if(!res.ok){
        const txt = await res.text();
        throw new Error('OpenAI error: ' + res.status + ' ' + txt);
      }
      const data = await res.json();
      const assistant = data.choices?.[0]?.message?.content || 'No response.';
      // remove placeholder and append real
      chat.removeChild(placeholder);
      addMessage('assistant', assistant);
      history.push({role:'assistant', content:assistant});
    } catch (err) {
      chat.removeChild(placeholder);
      addMessage('assistant', 'Error: ' + err.message);
      console.error(err);
    }
  }

  sendBtn.onclick = () => {
    const t = inputEl.value.trim();
    if(!t) return;
    inputEl.value = '';
    fetchReply(t);
  };

  inputEl.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendBtn.click(); }
  });

  // Welcome message
  addMessage('assistant', "Hello — I'm your coding AI. Paste an OpenAI API key above, then ask me to write, explain, or fix code. Example: \"Fix my fetch() code giving CORS\" or \"Show a simple Node.js Express example.\"");
</script>
</body>
</html>
